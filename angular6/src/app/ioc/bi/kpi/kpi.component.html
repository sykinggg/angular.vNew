<div class="row">
    <!-- 树 -->
    <div class="col-md-4">
        <div class="container-fluid py-2 border" [ngClass]="{true:'collapsed-box'}[schema?true:false]">
            <div class="box-header with-border">
                <h1 class="d-inline h5">
                    <i class="fa fa-bar-chart-o" aria-hidden="true"></i>
                    {{'CONFIG.KPI.KPI'|translate}}
                </h1>
                <div class="float-right">
                    <i class="fa fa-info toolbar-icon" (click)="showInfo()" title="{{'COMMON.INFORMATION'|translate}}"></i>&nbsp;
                    <i class="fa fa-plus toolbar-icon" (click)="newWgt()" title="{{'COMMON.NEW'|translate}}"></i>&nbsp;
                    <!-- <i [ngClass]="{false: 'd-none'}[!liteMode?true:false]" class="fa fa-copy toolbar-icon" (click)="copyNode()" title="{{'COMMON.COPY'|translate}}"></i> -->
                    <i class="fa fa-edit toolbar-icon" (click)="editNode()" title="{{'COMMON.EDIT'|translate}}"></i>
                    <i class="fa fa-trash-alt toolbar-icon" (click)="deleteNode()" title="{{'COMMON.DELETE'|translate}}"></i>
                    <!-- <i class="fa fa-bars toolbar-icon" data-widget="collapse"></i> -->
                </div>
            </div>
            <div class="box-body">
                <input type="text" class="form-control" placeholder="Search" [(ngModel)]="keywords" (keyup)="searchObservable.next(keywords)" title="dsr:kylin ds:Bill wg:test">
                <div class="panel-body" style="padding: 10px 0px; overflow-x: auto; font-size: small; max-height: 45vh">
                    <tree-root #dataSetTree [nodes]="originalData" [options]="treeOptions" (initialized)="initializedTree()" (moveNode)="moveNode($event)">
                            </tree-root>
                </div>
            </div>
        </div>
    </div>
    <!-- 右侧的编辑或新增 -->
    <div class="col-md-8" *ngIf="optFlag == 'new' || optFlag == 'edit'">
        <div class="container-fluid py-2 border">
            <h2 class="d-inline-block h5">
                {{curKPI.kpiName}}
                <span class="badge badge-secondary" [ngSwitch]="optFlag">
                    <span *ngSwitchCase="'edit'">{{'COMMON.EDIT'|translate}}</span>
                    <span *ngSwitchCase="'new'">{{'COMMON.NEW'|translate}}</span>
                </span>
            </h2>
            <div class="form-group row">
                <label class="col-sm-2 control-label text-right">{{'CONFIG.DASHBOARD.CATEGORY'|translate}}:</label>
                <div class="col-sm-10">
                    <select [(ngModel)]="curKPI.categoryId" class="form-control">
                        <option *ngFor="let option of datasourceList" [ngValue]="option.id">{{option.name}}</option>
                    </select>
                </div>
            </div>
            <div class="form-group row" [ngClass]="{'has-error': !(curKPI.kpiName && curKPI.kpiName.length)}">
                <label class="col-sm-2 control-label text-right">{{'CONFIG.DASHBOARD.NAME'|translate}}:</label>
                <div class="col-sm-10">
                    <input [(ngModel)]="curKPI.kpiName" class="form-control" />
                    <ngb-alert [dismissible]="false" type="danger" *ngIf="!curKPI.kpiName && validate">{{'CONFIG.DASHBOARD.NAME'|translate}}{{'COMMON.NOT_EMPTY'|translate}}</ngb-alert>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 control-label text-right" style="padding: 0px">{{'SIDEBAR.KPI'|translate}}{{'COMMON.DESXRIPTION'|translate}}:</label>
                <div class="col-sm-10">
                    <textarea [(ngModel)]="curKPI.description" class="form-control" cols="30" rows="10"></textarea>
                    <ngb-alert [dismissible]="false" type="danger" *ngIf="!curKPI.description && validate">{{'COMMON.DETAILS'|translate}}{{'COMMON.NOT_EMPTY'|translate}}</ngb-alert>
                </div>
            </div>
            <div dnd-sortable-container [sortableData]="curKPIWidgets" [dropZones]="['r']" class="py-2 mb-3 border-top border-dark" style="min-height: 50px;">
                <p>当前kpi中的widget</p>
                <button *ngFor="let item of curKPIWidgets let idx = index" class="btn btn-default btn-sm btn-group border" dnd-droppable (onDropSuccess)="dropSuccess()" dnd-sortable [sortableIndex]="idx" style="margin: 3px">
                    {{item.name}}
                </button>
                <ngb-alert [dismissible]="false" type="danger" *ngIf="(!curKPIWidgets || !curKPIWidgets.length) && validate">当前kpi中的widget{{'COMMON.NOT_EMPTY'|translate}}</ngb-alert>
            </div>
            <div dnd-sortable-container  [sortableData]="allWidget" [dropZones]="['r']" class="py-2 mb-3 border-top border-dark" style="min-height: 50px;">
                <p>所有的widget</p>
                <button *ngFor="let item of allWidget let idx = index"class="btn btn-default btn-sm btn-group border" dnd-droppable (onDropSuccess)="dropSuccess()" dnd-sortable [sortableIndex]="idx" style="margin: 3px">
                    {{item.name}}
                </button>
            </div>
            <hr />
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary" (click)="saveKPI()">
                    {{'COMMON.SAVE'|translate}}
                </button>
                <button type="button" class="btn btn-info" (click)="checkBeforPreviewShow = true">
                    {{'CONFIG.DASHBOARD.PREVIEW'|translate}}
                </button>
                <button type="button" class="btn btn-warning">
                    {{'COMMON.CANCEL'|translate}}
                </button>
            </div>
        </div>
        <div *ngIf="checkBeforPreviewShow">
            <div class="container-fluid" *ngFor="let kpiWidget of renderChart">
                <dashboard-widget [widget]="kpiWidget" [configurable]="'false'" [row]="{}" [widget]="12"></dashboard-widget>
            </div>
        </div>
    </div>
</div>