{"version":3,"sources":["src/board/generate-report.component.ts"],"names":[],"mappings":"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","file":"../../../src/board/generate-report.component.js","sourcesContent":["import { Component } from '@angular/core';\r\nimport { Router, NavigationExtras } from '@angular/router';\r\n\r\nimport { ApiServer, AfterDialogInit, DialogResult } from 'core-services/core';\r\nimport { REQUEST_OPTIONS } from '../request-options';\r\nimport { FilterData } from '../data/data-type';\r\nimport { DataService } from '../data/data.service';\r\nimport { ParamService } from '../param/param.service';\r\nimport { MenuService } from '../menu/menu.service';\r\n\r\n@Component({\r\n    template: require('./generate-report.component.html!text')\r\n})\r\n\r\nexport class GenerateReportComponent implements AfterDialogInit {\r\n    board: any;\r\n    formData = {\r\n        reportName: '',\r\n        statType: '2',\r\n        email: '',\r\n        recipients: []\r\n    };\r\n\r\n    constructor(\r\n        private router: Router,\r\n        private dataServer: ApiServer,\r\n        private menuService: MenuService,\r\n        private dataService: DataService,\r\n        private paramService: ParamService\r\n    ) {}\r\n\r\n    afterDialogInit(dialog: DialogResult, modalContent: any) {\r\n        let oldClose = dialog.modal.close;\r\n\r\n        this.board = dialog.data;\r\n        this.formData.reportName = this.board.reportName;\r\n        this.formData.statType = this.board.statType || '2';\r\n        this.formData.recipients = this.board.recipients ? this.board.recipients.split(',') : [];\r\n        dialog.modal.close = () => {\r\n            if (this.formData.reportName.trim()) {\r\n                this.dataServer.post(this.board.reportId ? 'edit-report' : 'add-report', {\r\n                    config: JSON.stringify({\r\n                        ...this.formData,\r\n                        recipients: this.formData.recipients.join(','),\r\n                        boardId: this.board.id,\r\n                        reportId: this.board.reportId,\r\n                        boardFilterParam: this.board.layout.rows[0].params.map((item) => {\r\n                            return new FilterData(item.col[0].column, item.type, item.values, null, this.paramService.getParamTitle(item));\r\n                        }),\r\n                        exportConfig: this.dataService.getConfigs(this.board)\r\n                    })\r\n                }, REQUEST_OPTIONS).subscribe((data: any) => {\r\n                    let id = data.id || this.board.reportId;\r\n                    let navigationExtras: NavigationExtras = {\r\n                        queryParams: {\r\n                            id: id,\r\n                            dateType: this.formData.statType\r\n                        }\r\n                    };\r\n\r\n                    this.board.reportName = this.formData.reportName;\r\n                    this.dataServer.request('reports', null, REQUEST_OPTIONS).subscribe((data: any) => {\r\n                        this.menuService.reportsSubject.next(data);\r\n                        oldClose(true);\r\n                        this.router.navigate(['/admin/report', id], navigationExtras);\r\n                    });\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    addEmail(input: any) {\r\n        if (!input.invalid) {\r\n            this.formData.recipients.unshift(input.value);\r\n            this.formData.email = '';\r\n        }\r\n    }\r\n\r\n    getParamTitle(param: any): string {\r\n        return this.paramService.getParamTitle(param);\r\n    }\r\n}\r\n"]}