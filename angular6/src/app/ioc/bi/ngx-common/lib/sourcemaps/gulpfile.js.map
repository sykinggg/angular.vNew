{"version":3,"sources":["gulpfile.ts"],"names":[],"mappings":"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","file":"../gulpfile.js","sourcesContent":["import * as gulp from 'gulp';\r\nimport { Pipe, Operation, IMap, IDynamicTaskOption, RunWay, ITaskConfig } from 'development-core';\r\nimport { Development, ITaskOption, IContext } from 'development-tool';\r\nimport 'development-tool-node';\r\nimport * as path from 'path';\r\nimport * as fs from 'fs';\r\n\r\nconst htmlMin = require('gulp-minify-html');\r\nconst sass = require('gulp-sass');\r\nconst cleanCSS = require('gulp-clean-css');\r\nconst rename = require('gulp-rename');\r\nconst uglify = require('gulp-uglify');\r\nconst del = require('del');\r\nconst through = require('through2');\r\nconst rollup = require('gulp-rollup');\r\nconst resolve = require('rollup-plugin-node-resolve');\r\nconst rollupSourcemaps = require('rollup-plugin-sourcemaps');\r\nconst commonjs = require('rollup-plugin-commonjs');\r\nconst builtins = require('rollup-plugin-node-builtins');\r\nconst globals = require('rollup-plugin-node-globals');\r\n\r\nDevelopment.create(gulp, __dirname, [\r\n    <ITaskConfig>{\r\n        name: 'libs',\r\n        src: './',\r\n        dist: 'lib',\r\n        testSrc: 'test/**/*.spec.ts',\r\n        loader: 'development-tool-node',\r\n        asserts: {\r\n            css: {\r\n                src: './**/*.css',\r\n                pipes: [\r\n                    ctx => cleanCSS()\r\n                ]\r\n            },\r\n            scss: {\r\n                src: './**/*.scss',\r\n                loader: [{\r\n                    oper: Operation.default | Operation.autoWatch,\r\n                    pipes: [\r\n                        (ctx) => sass({\r\n                            outputStyle: 'compressed',\r\n                            includePaths: [\r\n                                ctx.toDistPath('asserts'),\r\n                                ctx.toRootPath('../node_modules/bootstrap/scss')\r\n                            ]\r\n                        }).on('error', sass.logError)\r\n                    ]\r\n                }]\r\n            },\r\n            template: {\r\n                src: ['./**/*.template.html', './**/*.component.html', './**/*.tpl.html'],\r\n                loader: [{\r\n                    oper: Operation.default | Operation.autoWatch,\r\n                    pipes: [() => htmlMin({\r\n                        empty: true,\r\n                        spare: true,\r\n                        quotes: true,\r\n                        dom: {\r\n                            lowerCaseAttributeNames: false,\r\n                            lowerCaseTags: false\r\n                        }\r\n                    })]\r\n                }]\r\n            }\r\n        }\r\n    },\r\n    <ITaskOption>{\r\n        src: 'lib/**/*.js',\r\n        dist: 'lib',\r\n        loader: [\r\n            {\r\n                name: 'inline',\r\n                pipes: [\r\n                    ctx => through.obj(function (file, encoding, callback) {\r\n                        if (file.isNull()) {\r\n                            return callback(null, file);\r\n                        }\r\n\r\n                        if (file.isStream()) {\r\n                            return callback('doesn\\'t support Streams');\r\n                        }\r\n\r\n                        let contents: string = file.contents.toString('utf8');\r\n                        let regexp = /require\\(\\'\\S+!text\\'\\)/gi;\r\n                        let matchs = contents.match(regexp);\r\n                        if (matchs) {\r\n                            matchs.forEach(match => {\r\n                                let basepath = path.dirname(file.history[0]);\r\n                                let res = match.replace(`require('`, '').replace(`!text')`, '');\r\n                                res = path.join(basepath, res.replace('./', ''));\r\n                                console.log(match, res);\r\n                                if (fs.existsSync(res)) {\r\n                                    let content = fs.readFileSync(res, { encoding: 'utf8' });\r\n                                    content = content.trim().replace(/\\'/gi, '\\\\\\'')\r\n                                        .replace(/\\\"/gi, '\\\\\\\"');\r\n                                    contents = contents.replace(match, `'${content}'`)\r\n                                }\r\n                            });\r\n                        }\r\n                        file.contents = new Buffer(contents);\r\n                        this.push(file);\r\n                        callback();\r\n                    })\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    <ITaskOption>{\r\n        src: ['lib/**/*.js'],\r\n        dist: 'bundles',\r\n        oper: Operation.release | Operation.deploy,\r\n        loader: [\r\n            {\r\n                name: 'delbundles',\r\n                task: () => del('bundles')\r\n            },\r\n            {\r\n                name: 'browser',\r\n                pipes: [\r\n                    (ctx) => {\r\n                        return rollup({\r\n                            output: {\r\n                                name: 'common.umd.js',\r\n                                format: 'umd',\r\n                                globals: {\r\n                                    'reflect-metadata': 'Reflect',\r\n                                    'lodash': '_'\r\n                                }\r\n                            },\r\n                            plugins: [\r\n                                resolve(),\r\n                                commonjs(),\r\n                                globals(),\r\n                                builtins(),\r\n                                rollupSourcemaps()\r\n                            ],\r\n                            external: [\r\n                                'reflect-metadata',\r\n                                'tslib',\r\n                                '@ts-ioc/core',\r\n                                '@ts-ioc/platform-browser',\r\n                                'lodash',\r\n                                'rxjs',\r\n                                '@angular/core',\r\n                                '@angular/common',\r\n                                '@angular/common/http',\r\n                                '@angular/forms',\r\n                                '@angular/router',\r\n                                '@ngx-translate/core',\r\n                                '@ng-bootstrap/ng-bootstrap',\r\n                                'core-services/core'\r\n                            ],\r\n                            input: './lib/index.js'\r\n                        })\r\n                    },\r\n                    () => rename('common.umd.js'),\r\n                ]\r\n            },\r\n            {\r\n                name: 'zip',\r\n                src: 'bundles/common.umd.js',\r\n                pipes: [\r\n                    () => rename('common.umd.min.js'),\r\n                    () => uglify()\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n]).start();\r\n"]}