{"version":3,"sources":["src/chart/chartHeatMapTable.service.ts"],"names":[],"mappings":"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","file":"../../../src/chart/chartHeatMapTable.service.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Render } from './render';\r\n\r\n@Injectable()\r\n\r\nexport class ChartHeatMapTableService {\r\n    constructor(\r\n        private translateService: TranslateService\r\n    ) {\r\n    }\r\n\r\n    public render(containerDom, option, scope, persist) {\r\n        if (option == null) {\r\n            containerDom.html(\"<div class=\\\"alert alert-danger\\\" role=\\\"alert\\\">No Data!</div>\");\r\n            return null;\r\n        }\r\n        let height;\r\n\r\n        scope ? height = scope.myheight - 20 : null;\r\n\r\n        return new Render(containerDom, option).chart(height, persist);\r\n    };\r\n\r\n    public parseOption(data) {\r\n        let self = this;\r\n        var preferredLanguage = this.translateService.getDefaultLang();\r\n\r\n        var config = data.chartConfig;\r\n        var xAxisName = \"\";\r\n        for (var i in config.keys) {\r\n            xAxisName += +i == 0 ? config.keys[i].col : \"-\" + config.keys[i].col;\r\n        }\r\n        var yAxisName = \"\";\r\n        for (var i in config.groups) {\r\n            yAxisName += +i == 0 ? config.groups[i].col : \"-\" + config.groups[i].col;\r\n        }\r\n\r\n        var xAxisData = data.keys.map(function (item) {\r\n            return item.join('-');\r\n        });\r\n        var yAxisData = data.series.map(function (item) {\r\n            var newItem = [];\r\n            for (var i in item) {\r\n                if (+i != item.length - 1) {\r\n                    newItem.push(item[i]);\r\n                }\r\n            }\r\n            return newItem.join('-');\r\n        });\r\n\r\n        var min = 0;\r\n        var max = 0;\r\n        var datas = [];\r\n        for (var i in data.data) {\r\n            for (var j in data.data[i]) {\r\n                var value = isNaN(data.data[i][j]) ? 0 : parseFloat(data.data[i][j]);\r\n                min = value < min ? value : min;\r\n                max = value > max ? value : max;\r\n                datas.push([parseInt(j), parseInt(i), value]);\r\n            }\r\n        }\r\n\r\n        var style = config.values[0].style ? config.values[0].style : \"blue\";\r\n\r\n        var option = {\r\n            tooltip: {\r\n                //position: 'top',\r\n                /*axisPointer: { // 坐标轴指示器，坐标轴触发有效\r\n                 type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'\r\n                 },*/\r\n                trigger: 'item',\r\n                axisPointer: {\r\n                    show: false,\r\n                    type: 'shadow'\r\n                },\r\n                formatter: function (params) {\r\n                    return 'x ' + self.translateService.instant(\"CONFIG.WIDGET.VALUE_AXIS\") + ': ' + xAxisData[params.value[0]] +\r\n                        '<br/>y ' + self.translateService.instant(\"CONFIG.WIDGET.VALUE_AXIS\") + ': ' + yAxisData[params.value[1]] +\r\n                        '<br/>' + self.translateService.instant(\"COMMON.VALUE\") + ': ' + params.value[2];\r\n                }\r\n            },\r\n            animation: false,\r\n            toolbox: {\r\n                show: true,\r\n                feature: {\r\n                    mark: {show: false},\r\n                    dataView: {show: true, readOnly: true},\r\n                    restore: {show: false},\r\n                    saveAsImage: {show: true}\r\n                }\r\n            },\r\n            xAxis: {\r\n                name: xAxisName,\r\n                type: 'category',\r\n                data: xAxisData,\r\n                splitArea: {\r\n                    show: true\r\n                }\r\n            },\r\n            yAxis: {\r\n                name: yAxisName,\r\n                type: 'category',\r\n                data: yAxisData,\r\n                splitArea: {\r\n                    show: true\r\n                }\r\n            },\r\n            dataZoom: [\r\n                {\r\n                    type: 'slider',\r\n                    show: true,\r\n                    xAxisIndex: [0],\r\n                    start: 0,\r\n                    end: 100\r\n                }\r\n            ],\r\n            visualMap: {\r\n                min: min,\r\n                max: max,\r\n                calculable: true,\r\n                orient: 'horizontal',\r\n                left: 'left',\r\n                bottom: '90%',\r\n                inRange: {\r\n                    color: ['#eee', style]\r\n                }\r\n            },\r\n            series: [{\r\n                type: 'heatmap',\r\n                data: datas\r\n            }]\r\n        };\r\n\r\n        return option;\r\n    };\r\n}"]}