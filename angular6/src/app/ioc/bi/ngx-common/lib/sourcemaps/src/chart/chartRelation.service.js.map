{"version":3,"sources":["src/chart/chartRelation.service.ts"],"names":[],"mappings":";;;AAAA,sCAA2C;AAC3C,0BAA4B;AAC5B,mCAAkC;AAIlC;IACI;IACA,CAAC;IAEM,qCAAM,GAAb,UAAc,YAAY,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO;QAC9C,OAAO,IAAI,eAAM,CAAC,YAAY,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACvE,CAAC;IAAA,CAAC;IAEK,0CAAW,GAAlB,UAAmB,IAAI;QACnB,IAAI,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QACnC,IAAI,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC;QAC5B,IAAI,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC;QAChC,IAAI,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC;QAC/B,IAAI,eAAe,GAAG,IAAI,CAAC,YAAY,CAAC;QACxC,IAAI,UAAU,GAAG,WAAW,CAAC,MAAM,CAAC;QACpC,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,IAAI,WAAW,GAAG,EAAE,CAAC;QACrB,IAAI,WAAW,GAAG,EAAE,CAAC;QACrB,IAAI,cAAc,GAAG,UAAU,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QAC3D,IAAG,KAAK,CAAC,cAAc,CAAC,IAAI,cAAc,IAAI,CAAC,EAAC;YAC5C,cAAc,GAAG,CAAC,CAAC;SACtB;QACD,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,UAAS,CAAC;YAC1B,IAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC;gBAC5B,IAAI,IAAI,GAAQ,EAAE,CAAC;gBACnB,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACjB,IAAG,CAAC,CAAC,CAAC,CAAC,EAAE;oBACL,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,cAAc,CAAC;iBAC3C;gBACD,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACvB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aACpB;QACL,CAAC,CAAC,CAAC;QACH,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,UAAS,CAAC;YAC5B,IAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC;gBAC5B,IAAI,IAAI,GAAQ,EAAE,CAAC;gBACnB,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACjB,IAAG,CAAC,CAAC,CAAC,CAAC,EAAC;oBACJ,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,GAAC,cAAc,CAAC;iBACzC;gBACD,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACvB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aACpB;QACL,CAAC,CAAC,CAAC;QACH,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,aAAa,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;YACnC,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,WAAW,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;gBACjC,IAAG,CAAC,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAC;oBACnC,IAAI,IAAI,GAAQ,EAAE,CAAC;oBACnB,IAAI,CAAC,MAAM,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClC,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAChC,IAAI,CAAC,MAAM,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACnC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iBAC3B;aACJ;SACJ;QACD,IAAI,MAAM,GAAG;YACT,OAAO,EAAG;gBACN,OAAO,EAAE,MAAM;gBACf,SAAS,EAAE,UAAS,MAAM;oBACtB,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;oBACvB,IAAI,GAAG,CAAC;oBACR,IAAG,IAAI,CAAC,MAAM,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,IAAE,IAAI,EAAC;wBACxC,GAAG,GAAG,YAAY,GAAC,IAAI,CAAC,MAAM,GAAC,IAAI,GAAC,IAAI,CAAC,MAAM,CAAC;wBAChD,GAAG,IAAI,aAAa,GAAC,IAAI,CAAC,MAAM,CAAC;qBACpC;yBAAI;wBACD,GAAG,GAAG,YAAY,GAAC,IAAI,CAAC,IAAI,CAAC;wBAC7B,IAAG,IAAI,CAAC,KAAK,EAAC;4BACV,GAAG,IAAI,aAAa,GAAC,IAAI,CAAC,KAAK,CAAC;yBACnC;qBACJ;oBACD,OAAO,GAAG,CAAC;gBACf,CAAC;aACJ;YACD,OAAO,EAAE;gBACL,IAAI,EAAG,IAAI;gBACX,OAAO,EAAG;oBACN,OAAO,EAAG,EAAC,IAAI,EAAE,IAAI,EAAC;oBACtB,SAAS,EAAE,EAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;oBACjD,WAAW,EAAG,EAAC,IAAI,EAAE,KAAK,EAAC;iBAC9B;aACJ;YACD,MAAM,EAAG;gBACL;oBACI,IAAI,EAAE,OAAO;oBACb,MAAM,EAAE,OAAO;oBACf,IAAI,EAAE,IAAI;oBACV,MAAM,EAAC,QAAQ;oBACf,UAAU,EAAC,EAAE;oBACb,UAAU,EAAG,CAAE,MAAM,EAAE,OAAO,CAAE;oBAChC,cAAc,EAAG,EAAE;oBACnB,KAAK,EAAE;wBACH,UAAU,EAAE,UAAU;wBACtB,UAAU,EAAE,EAAE;wBACd,SAAS,EAAE,GAAG;wBACd,OAAO,EAAE,IAAI;wBACb,KAAK,EAAE,EAAE;qBACZ;oBACD,SAAS,EAAE;wBACP,MAAM,EAAE;4BACJ,KAAK,EAAE;gCACH,IAAI,EAAE,IAAI;gCACV,QAAQ,EAAE,OAAO;gCACjB,SAAS,EAAE;oCACP,KAAK,EAAE,MAAM;iCAChB;gCACD,SAAS,EAAE,UAAS,MAAM;oCACtB,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;oCACvB,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;oCACrB,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,GAAC,EAAE,EAAC;wCACtB,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,EAAC,EAAE,CAAC,GAAC,KAAK,CAAC;qCACrC;oCACD,OAAO,IAAI,CAAC;gCAChB,CAAC;6BACJ;4BACD,SAAS,EAAG;gCACR,SAAS,EAAG,MAAM;gCAClB,WAAW,EAAG,qBAAqB;gCACnC,WAAW,EAAG,CAAC;6BAClB;yBACJ;qBACJ;oBACD,SAAS,EAAG;wBACR,MAAM,EAAG;4BACL,gCAAgC;4BAChC,KAAK,EAAG,GAAG;4BACX,IAAI,EAAG,OAAO;4BACd,SAAS,EAAG,GAAG;4BACf,OAAO,EAAG,CAAC;yBACd;qBACJ;oBACD,IAAI,EAAE,WAAW;oBACjB,KAAK,EAAE,WAAW,CAAC,gEAAgE;iBACtF;aACJ;SACJ,CAAC;QACF,OAAO,MAAM,CAAC;IAClB,CAAC;IAAA,CAAC;IA1IO,oBAAoB;QAFhC,iBAAU,EAAE;;OAEA,oBAAoB,CA2IhC;IAAD,2BAAC;CA3ID,AA2IC,IAAA;AA3IY,oDAAoB","file":"../../../src/chart/chartRelation.service.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport * as _ from 'lodash';\r\nimport { Render } from './render';\r\n\r\n@Injectable()\r\n\r\nexport class ChartRelationService {\r\n    constructor() {\r\n    }\r\n\r\n    public render(containerDom, option, scope, persist) {\r\n        return new Render(containerDom, option, null).chart(null, persist);\r\n    };\r\n\r\n    public parseOption(data) {\r\n        var chartConfig = data.chartConfig;\r\n        var casted_keys = data.keys;\r\n        var casted_values = data.series;\r\n        var aggregate_data = data.data;\r\n        var newValuesConfig = data.seriesConfig;\r\n        var tunningOpt = chartConfig.option;\r\n        var names = [];\r\n        var optionNodes = [];\r\n        var optionLinks = [];\r\n        var nodeProportion = parseFloat(tunningOpt.nodeProportion);\r\n        if(isNaN(nodeProportion) || nodeProportion <= 0){\r\n            nodeProportion = 1;\r\n        }\r\n        _.each(casted_keys, function(e){\r\n            if($.inArray(e[0], names) == -1){\r\n                var node: any = {};\r\n                node.name = e[0];\r\n                if(e[1]) {\r\n                    node.value = e[1];\r\n                    node.symbolSize = e[1] * nodeProportion;\r\n                }\r\n                optionNodes.push(node);\r\n                names.push(e[0]);\r\n            }\r\n        });\r\n        _.each(casted_values, function(e){\r\n            if($.inArray(e[0], names) == -1){\r\n                var node: any = {};\r\n                node.name = e[0];\r\n                if(e[1]){\r\n                    node.value = e[1];\r\n                    node.symbolSize = e[1]*nodeProportion;\r\n                }\r\n                optionNodes.push(node);\r\n                names.push(e[0]);\r\n            }\r\n        });\r\n        for(var i=0;i<casted_values.length;i++){\r\n            for(var j=0;j<casted_keys.length;j++){\r\n                if(!_.isUndefined(aggregate_data[i][j])){\r\n                     var link: any = {};\r\n                     link.source = casted_values[i][0];\r\n                     link.target = casted_keys[j][0];\r\n                     link.weight = aggregate_data[i][j];\r\n                     optionLinks.push(link);\r\n                }\r\n            }\r\n        }\r\n        var option = {\r\n            tooltip : {\r\n                trigger: 'item',\r\n                formatter: function(params){\r\n                    var data = params.data;\r\n                    var res;\r\n                    if(data.source != null && data.target!=null){\r\n                        res = \"<br/>LINK：\"+data.source+\"->\"+data.target;\r\n                        res += \"<br/>VALUE：\"+data.weight;\r\n                    }else{\r\n                        res = \"<br/>NODE:\"+data.name;\r\n                        if(data.value){\r\n                            res += \"<br/>VALUE:\"+data.value;\r\n                        }\r\n                    }\r\n                    return res;\r\n                }\r\n            },\r\n            toolbox: {\r\n                show : true,\r\n                feature : {\r\n                    restore : {show: true},\r\n                    magicType: {show: true, type: ['force', 'chord']},\r\n                    saveAsImage : {show: false}\r\n                }\r\n            },\r\n            series : [\r\n                {\r\n                    type: 'graph',\r\n                    layout: 'force',\r\n                    name: \"关系\",\r\n                    symbol:'circle',\r\n                    symbolSize:15,\r\n                    edgeSymbol : [ 'none', 'arrow' ],\r\n                    edgeSymbolSize : 10,\r\n                    force: {\r\n                        initLayout: 'circular',\r\n                        edgeLength: 80,  // 长度\r\n                        repulsion: 100, // 排斥\r\n                        gravity: 0.03, // 收缩\r\n                        steps: 10\r\n                    },\r\n                    itemStyle: {\r\n                        normal: {\r\n                            label: {\r\n                                show: true,\r\n                                position: 'right',\r\n                                textStyle: {\r\n                                    color: '#333'\r\n                                },\r\n                                formatter: function(params){\r\n                                    var data = params.data;\r\n                                    var name = data.name;\r\n                                    if(name && name.length>10){\r\n                                        name = name.substring(0,10)+\"...\";\r\n                                    }\r\n                                    return name;\r\n                                }\r\n                            },\r\n                            nodeStyle : {\r\n                                brushType : 'both',\r\n                                borderColor : 'rgba(255,215,0,0.4)',\r\n                                borderWidth : 1\r\n                            }\r\n                        }\r\n                    },\r\n                    lineStyle : {\r\n                        normal : {\r\n                            //color : 'rgba(255,0,255,0.4)',\r\n                            width : '1',\r\n                            type : 'solid', //'solid'（实线）'dashed'（虚线）'dotted'（点线）\r\n                            curveness : 0.2, //线条的曲线程度，从0到1\r\n                            opacity : 1,  // 图形透明度。支持从 0 到 1 的数字，为 0 时不绘制该图形。默认0.5\r\n                        }\r\n                    },\r\n                    data: optionNodes, //[{category:'预警客户', name: '*剑荣', value : 0},{category:'普通客户', name: '*静礼', value : 0}],\r\n                    links: optionLinks //[{source : '*剑荣', target : '*静礼', weight : 0, name: '客户担保关系'}]\r\n                }\r\n            ]\r\n        };\r\n        return option;\r\n    };\r\n}"]}