{"version":3,"sources":["src/chart/chartContrast.service.ts"],"names":[],"mappings":"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","file":"../../../src/chart/chartContrast.service.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport * as _ from 'lodash';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { UpdateEchartOptionsService } from './common/updateechartOptions.service';\r\nimport { Render } from './render';\r\n\r\n@Injectable()\r\n\r\nexport class ChartContrastService {\r\n    constructor(\r\n        private activatedRoute: ActivatedRoute,\r\n        private updateEchartOptionsService: UpdateEchartOptionsService\r\n    ) {\r\n    }\r\n\r\n    public render(containerDom, option, scope, persist, drill, relations, chartConfig) {\r\n        let render = new Render(containerDom, option);\r\n\r\n        render.addClick(chartConfig, relations, this.activatedRoute);\r\n\r\n        return render.chart(null, persist);\r\n    };\r\n\r\n    public parseOption(data) {\r\n        var chartConfig = data.chartConfig;\r\n        var casted_keys = data.keys;\r\n        var casted_values = data.series;\r\n        var aggregate_data = data.data;\r\n        var newValuesConfig = data.seriesConfig;\r\n        var tunningOpt = chartConfig.option;\r\n        var string_keys = _.map(casted_keys, function (key) {\r\n            return key.join('-');\r\n        });\r\n\r\n        var max = aggregate_data[0][0];\r\n        _.each(aggregate_data, function(arr){\r\n            _.each(arr, function(e){\r\n                if(parseFloat(e) > parseFloat(max)){\r\n                    max = e;\r\n                }\r\n            });\r\n        });\r\n\r\n        var Axis = [\r\n            {\r\n                type : 'value',\r\n                min:-max,\r\n                max:max\r\n            }\r\n        ];\r\n        var valueAxis = [\r\n            {\r\n                type : 'category',\r\n                axisTick : {show: false},\r\n                data : string_keys\r\n            }\r\n        ];\r\n        let echartOptionData = [casted_values[0] || '',casted_values[1] || 0];\r\n        if(casted_values[0] && casted_values[1]) {\r\n            echartOptionData = [casted_values[0][0] || casted_values[0] || '',casted_values[1][0] || casted_values[1] || 0];\r\n        }\r\n        var echartOption = {\r\n            tooltip: {\r\n                formatter: function (params) {\r\n                    var name = params[0].name;\r\n                    var s = name + \"</br>\";\r\n                    for (var i = 0; i < params.length; i++) {\r\n                        s += '<span style=\"display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:' + params[i].color + '\"></span>';\r\n                        if (params[i].value instanceof Array) {\r\n                            s += params[i].seriesName + \" : \" + params[i].value[1] + \"% (\" + params[i].value[2] + \")<br>\";\r\n                        } else {\r\n                            s += params[i].seriesName + \" : \" + params[i].value + \"<br>\";\r\n                        }\r\n                    }\r\n                    return s;\r\n                }\r\n            },\r\n            legend: {\r\n                data: echartOptionData\r\n            },\r\n            grid: {\r\n                left: '3%',\r\n                right: '4%',\r\n                bottom: '3%',\r\n                containLabel: true\r\n            },\r\n            xAxis : chartConfig.valueAxis == \"horizontal\" ? valueAxis:Axis,\r\n            yAxis : chartConfig.valueAxis == \"horizontal\" ? Axis:valueAxis,\r\n            series : [\r\n                {\r\n                    name:casted_values[0],\r\n                    type:'bar',\r\n                    stack: '总量',\r\n                    barWidth: 20,\r\n                    label: {\r\n                        normal: {\r\n                            show: false\r\n                        }\r\n                    },\r\n                    itemStyle:{\r\n                        normal: {\r\n                            color : '#C23531'\r\n                        }\r\n                    },\r\n                    data:_.map(aggregate_data[0],function(e){return -e})\r\n                },\r\n                {\r\n                    name:casted_values[1],\r\n                    type:'bar',\r\n                    stack: '总量',\r\n                    barWidth: 20,\r\n                    label: {\r\n                        normal: {\r\n                            show: false\r\n                        }\r\n                    },\r\n                    itemStyle:{\r\n                        normal: {\r\n                            color : '#3C8DBC'\r\n                        }\r\n                    },\r\n                    data:aggregate_data[1]\r\n                }\r\n            ]\r\n        };\r\n\r\n        this.updateEchartOptionsService.updateEchartOptions(tunningOpt, echartOption);\r\n        return echartOption;\r\n    };\r\n}"]}