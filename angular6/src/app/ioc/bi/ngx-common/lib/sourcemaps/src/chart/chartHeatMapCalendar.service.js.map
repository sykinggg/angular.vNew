{"version":3,"sources":["src/chart/chartHeatMapCalendar.service.ts"],"names":[],"mappings":"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","file":"../../../src/chart/chartHeatMapCalendar.service.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Render } from './render';\r\nvar echarts = require('echarts');\r\n\r\n@Injectable()\r\n\r\nexport class ChartHeatMapCalendarService {\r\n    constructor(\r\n        private translateService: TranslateService\r\n    ) {\r\n    }\r\n\r\n    public render(containerDom, option, scope, persist) {\r\n        if (option == null) {\r\n            containerDom.html(\"<div class=\\\"alert alert-danger\\\" role=\\\"alert\\\">No Data!</div>\");\r\n            return;\r\n        }\r\n        let height;\r\n\r\n        scope ? height = scope.myheight - 20 : null;\r\n\r\n        return new Render(containerDom, option).chart(height, persist);\r\n    };\r\n\r\n    public parseOption(data) {\r\n        let self = this;\r\n        var preferredLanguage = this.translateService.getDefaultLang();\r\n        var config = data.chartConfig;\r\n        var dateFormat = config.values[0].dateFormat ? config.values[0].dateFormat : \"yyyy-MM-dd\";\r\n        var style = config.values[0].style ? config.values[0].style : \"blue\";\r\n\r\n        var dates = data.keys.map(function (item) {\r\n            var date = item[0];\r\n            if (\"yyyyMMdd\" == dateFormat) {\r\n                return date.substr(0, 4) + '-' + date.substr(4, 2) + '-' + date.substr(6, 2);\r\n            } else if (\"yyyy/MM/dd\" == dateFormat) {\r\n                return date.replace(/\\//g, '-')\r\n            }\r\n            return date;\r\n        });\r\n\r\n        var yearMap = {};\r\n        dates.map(function (date) {\r\n            var time = +echarts.number.parseDate(date);\r\n            if (time) {\r\n                let year = echarts.format.formatTime('yyyy', time);\r\n                yearMap[year] = 1;\r\n            }\r\n        });\r\n        var yearArr = [];\r\n        for (let year in yearMap) {\r\n            yearArr.push(year);\r\n        }\r\n        // 从大到小\r\n        yearArr.sort(function (a, b) {\r\n            return b - a\r\n        });\r\n        var count = 0;\r\n        var calendar = yearArr.map(function (year) {\r\n            return {\r\n                top: 50 + 140 * count++,\r\n                cellSize: ['auto', 15],\r\n                range: year,\r\n                itemStyle: {\r\n                    normal: {borderWidth: 0.5}\r\n                },\r\n                monthLabel: {\r\n                    nameMap: preferredLanguage\r\n                },\r\n                dayLabel: {\r\n                    firstDay: 1,\r\n                    nameMap: preferredLanguage\r\n                },\r\n                yearLabel: {show: true}\r\n            };\r\n        });\r\n\r\n        var min = 0;\r\n        var max = 0;\r\n        var dataMap = {};\r\n        var datas = [];\r\n        for (var i in data.keys) {\r\n            var time = +echarts.number.parseDate(dates[i]);\r\n            if (time) {\r\n                var year = echarts.format.formatTime('yyyy', time);\r\n                var date = echarts.format.formatTime('yyyy-MM-dd', time);\r\n                if (dataMap[year])\r\n                    datas = dataMap[year];\r\n                else\r\n                    datas = [];\r\n                var value = data.data[0][i];\r\n                min = value < min ? value : min;\r\n                max = value > max ? value : max;\r\n                datas.push([date, value]);\r\n                dataMap[year] = datas;\r\n            }\r\n        }\r\n        count = 0;\r\n        var series = yearArr.map(function (year) {\r\n            return {\r\n                type: 'heatmap',\r\n                coordinateSystem: 'calendar',\r\n                calendarIndex: count++,\r\n                data: dataMap[year]\r\n            };\r\n        });\r\n\r\n        var option = {\r\n            tooltip: {\r\n                position: 'top',\r\n                trigger: 'item',\r\n                axisPointer: {\r\n                    show: false,\r\n                    type: 'shadow'\r\n                },\r\n                formatter: function (params) {\r\n                    return self.translateService.instant(\"COMMON.DATE\") + ': ' + params.value[0] + \"<br>\"\r\n                        + self.translateService.instant(\"COMMON.VALUE\") + \": \" + params.value[1];\r\n                }\r\n            },\r\n            toolbox: {\r\n                show: true,\r\n                feature: {\r\n                    mark: {show: false},\r\n                    dataView: {show: true, readOnly: true},\r\n                    restore: {show: false},\r\n                    saveAsImage: {show: true}\r\n                }\r\n            },\r\n            visualMap: {\r\n                min: min,\r\n                max: max,\r\n                calculable: true,\r\n                orient: 'horizontal',\r\n                left: 'left',\r\n                bottom: '90%',\r\n                inRange: {\r\n                    color: ['#eee', style]\r\n                }\r\n            },\r\n            calendar: calendar,\r\n            series: series\r\n        };\r\n\r\n        return option;\r\n    };\r\n}"]}